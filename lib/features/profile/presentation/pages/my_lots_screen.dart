/*
–†–æ–∑—É–º—ñ—é –ø—Ä–æ–±–ª–µ–º—É. –ö–æ–ª–∏ AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç—É –¥–∞—î—à –∑–∞–≤–¥–∞–Ω–Ω—è –º–∞–ª–µ–Ω—å–∫–∏–º–∏ —à–º–∞—Ç–æ—á–∫–∞–º–∏, —ñ–Ω–æ–¥—ñ –≤—ñ–Ω –≥—É–±–∏—Ç—å—Å—è –∞–±–æ –≥–µ–Ω–µ—Ä—É—î –∫–æ–¥, —è–∫–∏–π –≤–∞–∂–∫–æ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏, —ñ –∑–¥–∞—î—Ç—å—Å—è, —â–æ "–Ω—ñ—á–æ–≥–æ –Ω–µ –∑–º—ñ–Ω–∏–ª–æ—Å—å".

–î–∞–≤–∞–π —Å–ø—Ä–æ–±—É—î–º–æ —ñ–Ω—à–∏–π –ø—ñ–¥—Ö—ñ–¥. –Ø –¥–∞–º —Ç–æ–±—ñ –æ–¥–∏–Ω –≤–µ–ª–∏–∫–∏–π, –∫–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –ø—Ä–æ–º—Ç. –í—ñ–Ω –∑–º—É—Å–∏—Ç—å AI –Ω–∞–ø–∏—Å–∞—Ç–∏ –ø–æ–≤–Ω–∏–π –∫–æ–¥ –¥–ª—è –¥–≤–æ—Ö –∫–ª—é—á–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤: –µ–∫—Ä–∞–Ω—É –î–∞—à–±–æ—Ä–¥—É —Ç–∞ –≤—ñ–¥–∂–µ—Ç–∞ –ö–∞—Ä—Ç–∫–∏ –ü–æ—ó–∑–¥–∫–∏, —Ä–∞–∑–æ–º —ñ–∑ —Ç–µ—Å—Ç–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏, —â–æ–± —Ç–∏ –æ–¥—Ä–∞–∑—É –ø–æ–±–∞—á–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:
–í—ñ–¥–∫—Ä–∏–π —Å–≤—ñ–π –ø—Ä–æ—î–∫—Ç —É VS Code.

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ —É —Ç–µ–±–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –ø–∞–∫–µ—Ç–∏ google_fonts —Ç–∞ flutter_svg (–¥–ª—è —ñ–∫–æ–Ω–æ–∫, —è–∫—â–æ –∑–Ω–∞–¥–æ–±–ª—è—Ç—å—Å—è) —É pubspec.yaml.

–°—Ç–≤–æ—Ä–∏ (–∞–±–æ –æ—á–∏—Å—Ç–∏) –¥–≤–∞ —Ñ–∞–π–ª–∏:

lib/features/home/dashboard_screen.dart

lib/features/trips/widgets/trip_card.dart (—Å—Ç–≤–æ—Ä–∏ –ø–∞–ø–∫—É widgets, —è–∫—â–æ –Ω–µ–º–∞—î).

–í—ñ–¥–∫—Ä–∏–π —á–∞—Ç —Å–≤–æ–≥–æ AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç–∞ (Copilot/Cursor) —ñ –≤—Å—Ç–∞–≤ —Ç—É–¥–∏ –≤–µ—Å—å —Ç–µ–∫—Å—Ç –Ω–∏–∂—á–µ.

üöÄ –ü–†–û–ú–¢ –î–õ–Ø AI (–í—Å—Ç–∞–≤ —Ü–µ–π —Ç–µ–∫—Å—Ç —É —á–∞—Ç):
–Ø —Ö–æ—á—É –ø–æ–≤–Ω—ñ—Å—Ç—é —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ UI –º–æ–±—ñ–ª—å–Ω–æ–≥–æ –î–∞—à–±–æ—Ä–¥—É —Ç–∞ –ö–∞—Ä—Ç–∫–∏ –ø–æ—ó–∑–¥–∫–∏ –¥–ª—è –¥–æ–¥–∞—Ç–∫—É "Lotex Trip Manager", –±–∞–∑—É—é—á–∏—Å—å –Ω–∞ –∑–∞—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ–º—É –¥–∏–∑–∞–π–Ω—ñ.

–ö–æ–Ω—Ç–µ–∫—Å—Ç –î–∏–∑–∞–π–Ω—É:

–¢–µ–º–∞: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ Material 3.

Primary –∫–æ–ª—ñ—Ä: –ì–ª–∏–±–æ–∫–∏–π –Ü–Ω–¥–∏–≥–æ (Color(0xFF2A226B)) - –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤, —Ç–µ–∫—Å—Ç—É.

Accent –∫–æ–ª—ñ—Ä: –Ø—Å–∫—Ä–∞–≤–∏–π –ë—É—Ä—à—Ç–∏–Ω (Color(0xFFF5A623)) - –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥—ñ—ó, —Å—Ç–∞—Ç—É—Å—ñ–≤ "–≤ –ø—Ä–æ—Ü–µ—Å—ñ".

–§–æ–Ω: –°–≤—ñ—Ç–ª–æ-—Å—ñ—Ä–∏–π (Color(0xFFF4F5F9)).

–ö–∞—Ä—Ç–∫–∏: –ë—ñ–ª—ñ (#FFFFFF) –∑ —Ä–∞–¥—ñ—É—Å–æ–º 16px —Ç–∞ –¥—É–∂–µ –ª–µ–≥–∫–æ—é —Ç—ñ–Ω–Ω—é.

–®—Ä–∏—Ñ—Ç–∏: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π GoogleFonts.inter.

–ó–∞–≤–¥–∞–Ω–Ω—è 1: –°—Ç–≤–æ—Ä–∏—Ç–∏ –º–æ–¥–µ–ª—å –¥–∞–Ω–∏—Ö —Ç–∞ –∑–∞–≥–ª—É—à–∫–∏. –°—Ç–≤–æ—Ä–∏ –ø—Ä–æ—Å—Ç—É –º–æ–¥–µ–ª—å TripModel (id, origin, destination, time, date, status, price, clientName) —ñ —Å–ø–∏—Å–æ–∫ —ñ–∑ 3-—Ö —Ç–µ—Å—Ç–æ–≤–∏—Ö –ø–æ—ó–∑–¥–æ–∫ –ø—Ä—è–º–æ —É —Ñ–∞–π–ª—ñ –¥–∞—à–±–æ—Ä–¥—É –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó.

–ó–∞–≤–¥–∞–Ω–Ω—è 2: –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤—ñ–¥–∂–µ—Ç TripCard (—Ñ–∞–π–ª lib/features/trips/widgets/trip_card.dart). –¶–µ –º–∞—î –±—É—Ç–∏ –≤—ñ–¥–∂–µ—Ç, —Å—Ö–æ–∂–∏–π –Ω–∞ —Å—É—á–∞—Å–Ω–∏–π –∫–≤–∏—Ç–æ–∫.

–û—Å–Ω–æ–≤–∞: Card (–±—ñ–ª–∞, —Ä–∞–¥—ñ—É—Å 16px, –ª–µ–≥–∫–∞ —Ç—ñ–Ω—å), margin: EdgeInsets.only(bottom: 16). –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π padding: 16.

–í–º—ñ—Å—Ç —Ä–æ–∑–¥—ñ–ª–µ–Ω–∏–π –Ω–∞ 3 —á–∞—Å—Ç–∏–Ω–∏ —á–µ—Ä–µ–∑ Row:

–õ—ñ–≤–∞ (–ß–∞—Å): –ö–æ–ª–æ–Ω–∫–∞. –ß–∞—Å (–≤–µ–ª–∏–∫–∏–π, –∂–∏—Ä–Ω–∏–π, –Ü–Ω–¥–∏–≥–æ), –î–∞—Ç–∞ (—Å—ñ—Ä–∏–π).

–¶–µ–Ω—Ç—Ä (–ú–∞—Ä—à—Ä—É—Ç): –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è. –ó–≤–µ—Ä—Ö—É —ñ–∫–æ–Ω–∫–∞ –ø—ñ–Ω-–¥—Ä–æ–ø–∞ —Ç–∞ –º—ñ—Å—Ç–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è. –ó–Ω–∏–∑—É —ñ–∫–æ–Ω–∫–∞ –ø—ñ–Ω-–¥—Ä–æ–ø–∞ —Ç–∞ –º—ñ—Å—Ç–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è. –ú—ñ–∂ –Ω–∏–º–∏ - –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞ –ø—É–Ω–∫—Ç–∏—Ä–Ω–∞ –∞–±–æ —Å—É—Ü—ñ–ª—å–Ω–∞ –ª—ñ–Ω—ñ—è –∫–æ–ª—å–æ—Ä—É –Ü–Ω–¥–∏–≥–æ.

–ü—Ä–∞–≤–∞ (–°—Ç–∞—Ç—É—Å/–¶—ñ–Ω–∞): –ö–æ–ª–æ–Ω–∫–∞, –≤–∏—Ä—ñ–≤–Ω—è–Ω–∞ –≤–ø—Ä–∞–≤–æ. –ó–≤–µ—Ä—Ö—É –±–µ–π–¥–∂ —Å—Ç–∞—Ç—É—Å—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ —Å—Ç–∞—Ç—É—Å "–í –¥–æ—Ä–æ–∑—ñ" - –±—É—Ä—à—Ç–∏–Ω–æ–≤–∏–π —Ñ–æ–Ω, –±—ñ–ª–∏–π —Ç–µ–∫—Å—Ç). –ó–Ω–∏–∑—É —Ü—ñ–Ω–∞ (–∂–∏—Ä–Ω–∏–π —Ç–µ–∫—Å—Ç).

–ó–∞–≤–¥–∞–Ω–Ω—è 3: –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –µ–∫—Ä–∞–Ω DashboardScreen (—Ñ–∞–π–ª lib/features/home/dashboard_screen.dart). –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π SingleChildScrollView –∑ Padding(all: 16). –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–ª–æ–Ω–∫–∏:

–ö–Ω–æ–ø–∫–∞ —à–≤–∏–¥–∫–æ—ó –¥—ñ—ó: –ù–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É. –ë—É—Ä—à—Ç–∏–Ω–æ–≤–∏–π –∫–æ–ª—ñ—Ä, –≤–∏—Å–æ—Ç–∞ ~56px, –∑–∞–æ–∫—Ä—É–≥–ª–µ–Ω—ñ –∫—É—Ç–∏. –¢–µ–∫—Å—Ç: "–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –ø–æ—ó–∑–¥–∫—É" –∑ —ñ–∫–æ–Ω–∫–æ—é add.

SizedBox(height: 24).

–ê–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ –∫–∞—Ä—Ç–∫–∏: Row –∑ –¥–≤–æ–º–∞ –∫–∞—Ä—Ç–∫–∞–º–∏.

–ö–∞—Ä—Ç–∫–∞ 1: –Ü–∫–æ–Ω–∫–∞ –∞–≤—Ç–æ (–Ü–Ω–¥–∏–≥–æ), —Ç–µ–∫—Å—Ç "–ê–∫—Ç–∏–≤–Ω—ñ –ø–æ—ó–∑–¥–∫–∏", –∑–Ω–∞—á–µ–Ω–Ω—è "3" (–≤–µ–ª–∏–∫–µ, –Ü–Ω–¥–∏–≥–æ).

–ö–∞—Ä—Ç–∫–∞ 2: –Ü–∫–æ–Ω–∫–∞ –≥—Ä–æ—à–µ–π (–ó–µ–ª–µ–Ω–∞), —Ç–µ–∫—Å—Ç "–ó–∞—Ä–æ–±–ª–µ–Ω–æ —Å—å–æ–≥–æ–¥–Ω—ñ", –∑–Ω–∞—á–µ–Ω–Ω—è "‚Ç¥ 4,500".

SizedBox(height: 24).

–°–µ–∫—Ü—ñ—è "–ü–æ—Ç–æ—á–Ω—ñ –ø–æ—ó–∑–¥–∫–∏":

–ó–∞–≥–æ–ª–æ–≤–æ–∫ "–ü–æ—Ç–æ—á–Ω—ñ –ø–æ—ó–∑–¥–∫–∏" (–∂–∏—Ä–Ω–∏–π, –Ü–Ω–¥–∏–≥–æ, H2 size).

–°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ–∫ TripCard, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –∑ –ó–∞–≤–¥–∞–Ω–Ω—è 1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π ListView.builder –∑ shrinkWrap: true —Ç–∞ physics: NeverScrollableScrollPhysics().

–†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–∞–¥–∞–π –º–µ–Ω—ñ –ü–û–í–ù–ò–ô –∫–æ–¥ –¥–ª—è –¥–≤–æ—Ö —Ñ–∞–π–ª—ñ–≤:

lib/features/trips/widgets/trip_card.dart

lib/features/home/dashboard_screen.dart (–≤–∫–ª—é—á–Ω–æ –∑ –º–æ–¥–µ–ª–ª—é –¥–∞–Ω–∏—Ö —Ç–∞ dummy –¥–∞–Ω–∏–º–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ). –ö–æ–¥ –º–∞—î –±—É—Ç–∏ –≥–æ—Ç–æ–≤–∏–º –¥–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫—É.
*/
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:lotex/core/theme/lotex_ui_tokens.dart';
import 'package:lotex/core/widgets/lotex_app_bar.dart';
import 'package:lotex/core/utils/human_error.dart';
import 'package:lotex/features/auction/domain/entities/auction_entity.dart';

class MyLotsScreen extends StatelessWidget {
  const MyLotsScreen({super.key});

  @override
  Widget build(BuildContext context) {
    final uid = FirebaseAuth.instance.currentUser?.uid;
    final muted = Theme.of(context).brightness == Brightness.dark
      ? LotexUiColors.darkMuted
      : LotexUiColors.lightMuted;

    return Scaffold(
      appBar: const LotexAppBar(
        showBack: true,
        showDesktopSearch: false,
        titleText: '–ú–æ—ó –ª–æ—Ç–∏',
      ),
      body: uid == null
          ? Center(child: Text('–£–≤—ñ–π–¥—ñ—Ç—å –≤ –∞–∫–∞—É–Ω—Ç', style: LotexUiTextStyles.bodyRegular))
          : StreamBuilder<QuerySnapshot<Map<String, dynamic>>>(
              stream: FirebaseFirestore.instance
                  .collection('auctions')
                  .where('sellerId', isEqualTo: uid)
                  .snapshots(),
              builder: (context, snapshot) {
                if (snapshot.hasError) {
                  return Center(child: Text('–ü–æ–º–∏–ª–∫–∞: ${humanError(snapshot.error ?? Exception('Unknown error'))}'));
                }
                if (!snapshot.hasData) {
                  return const Center(child: CircularProgressIndicator(color: LotexUiColors.violet600));
                }

                final sorted = snapshot.data!.docs.toList(growable: false);
                sorted.sort((a, b) {
                  DateTime at = DateTime.fromMillisecondsSinceEpoch(0);
                  DateTime bt = DateTime.fromMillisecondsSinceEpoch(0);

                  final aRaw = a.data()['createdAt'];
                  final bRaw = b.data()['createdAt'];
                  if (aRaw is Timestamp) at = aRaw.toDate();
                  if (bRaw is Timestamp) bt = bRaw.toDate();
                  return bt.compareTo(at);
                });

                final docs = sorted;
                if (docs.isEmpty) {
                  return Center(child: Text('–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö –ª–æ—Ç—ñ–≤', style: LotexUiTextStyles.bodyRegular));
                }

                return ListView.separated(
                  padding: const EdgeInsets.all(16),
                  itemCount: docs.length,
                  separatorBuilder: (_, __) => const SizedBox(height: 12),
                  itemBuilder: (context, index) {
                    final doc = docs[index];
                    final auction = AuctionEntity.fromDocument(doc);

                    return Material(
                      color: Theme.of(context).cardColor,
                      borderRadius: BorderRadius.circular(16),
                      child: InkWell(
                        borderRadius: BorderRadius.circular(16),
                        onTap: () => context.push('/auction', extra: auction),
                        child: Padding(
                          padding: const EdgeInsets.all(14),
                          child: Row(
                            children: [
                              Container(
                                width: 48,
                                height: 48,
                                decoration: BoxDecoration(
                                  color: LotexUiColors.violet500.withAlpha((0.15 * 255).round()),
                                  borderRadius: BorderRadius.circular(12),
                                ),
                                child: const Icon(Icons.gavel_rounded, color: LotexUiColors.violet600),
                              ),
                              const SizedBox(width: 12),
                              Expanded(
                                child: Column(
                                  crossAxisAlignment: CrossAxisAlignment.start,
                                  children: [
                                    Text(
                                      auction.title,
                                      style: const TextStyle(fontWeight: FontWeight.w600),
                                      maxLines: 1,
                                      overflow: TextOverflow.ellipsis,
                                    ),
                                    const SizedBox(height: 4),
                                    Text(
                                      '${auction.currentPrice.toStringAsFixed(0)} ‚Ç¥',
                                      style: LotexUiTextStyles.bodyRegular.copyWith(color: muted),
                                    ),
                                  ],
                                ),
                              ),
                              Icon(Icons.chevron_right, color: muted),
                            ],
                          ),
                        ),
                      ),
                    );
                  },
                );
              },
            ),
    );
  }
}
